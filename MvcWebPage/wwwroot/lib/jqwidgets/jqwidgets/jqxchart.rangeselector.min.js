!function(m){m.extend(m.jqx._jqxChart.prototype,{_moduleRangeSelector:!0,_renderXAxisRangeSelector:function(e,t){var s=this,i=(s._isTouchDevice=m.jqx.mobile.isTouchDevice(),s.seriesGroups[e]),r=s._getXAxis(e),o=r?r.rangeSelector:void 0;if(s._isSelectorRefresh||(o&&o.renderTo?o.renderTo:s.host).find(".rangeSelector").remove(),!r||0==r.visible||"spider"==i.type)return!1;if(!s._isGroupVisible(e))return!1;if(!o)return!1;var a,n,i="horizontal"==i.orientation,s=(o.renderTo&&(i=!1),s.rtl&&(r.flip=!0),i?this.host.height():this.host.width()),l=this._getXAxisStats(e,r,s-=4),d=r.position;return o.renderTo&&o.position&&(d=o.position),this._isSelectorRefresh||(o=o.renderTo,a=m("<div class='rangeSelector jqx-disableselect' style='position: absolute; background-color: transparent;' onselectstart='return false;'></div>").appendTo(o||this.renderer.getContainer()),o?(a.css({width:o.width(),height:o.height()}),t.width=o.width(),t.height=o.height()):((o=this.host.coord()).top=0,o.left=0,n=this._selectorGetSize(r),i?(a.css("left",o.left+1+t.x+("right"!=d?-n:t.width)),a.css("top",o.top),a.css("height",s),a.css("width",n),t.height=n):(a.css("left",o.left+1),a.css("top",o.top+t.y+("top"!=d?t.height:-n)),a.css("height",n),a.css("width",s))),this._refreshSelector(e,r,l,a,t,i)),!(this._isSelectorRefresh=!1)},_refreshSelector:function(e,t,s,i,r,o){var a={},n=t.rangeSelector;this.seriesGroups[e];for(p in n)a[p]=n[p];delete a.padding;var l=a.minValue,d=a.maxValue,s=(null==l&&(l=Math.min(s.min.valueOf(),s.dsRange.min.valueOf())),null==d&&(d=Math.max(s.max.valueOf(),s.dsRange.max.valueOf())),this._isDate(s.min)&&(l=new Date(l)),this._isDate(s.max)&&(d=new Date(d)),t.position),l=(n.renderTo&&n.position&&(s=n.position),a.dataField=t.dataField,delete a.rangeSelector,a.type=t.type,a.baseUnit=n.baseUnit||t.baseUnit,a.minValue=l,a.maxValue=d,a.flip=t.flip,a.position=s,2),d=2,h=2,c=2;n.renderTo||(l=o?0:r.x,d=o?0:this._rect.width-r.x-r.width,h=o?r.y:5,c=o?this._paddedRect.height-this._plotRect.height:5);for(var r=null!=(r=n.padding)||n.renderTo?{left:r&&r.left?r.left:l,top:r&&r.top?r.top:h,right:r&&r.right?r.right:d,bottom:r&&r.bottom?r.bottom:c}:{left:l,top:h,right:d,bottom:c},g=t.rangeSelector.dataField,p=0;null==g&&p<this.seriesGroups.length;p++)for(var u=0;null==g&&u<this.seriesGroups[p].series.length;u++)g=this.seriesGroups[p].series[u].dataField;var l={padding:r,_isRangeSelectorInstance:!0,title:n.title||"",description:n.description||"",titlePadding:n.titlePadding,colorScheme:n.colorScheme||this.colorScheme,backgroundColor:n.backgroundColor||this.backgroundColor||"transparent",backgroundImage:n.backgroundImage||"",showBorderLine:n.showBorderLine||!!n.renderTo,borderLineWidth:n.borderLineWidth||this.borderLineWidth,borderLineColor:n.borderLineColor||this.borderLineColor,rtl:n.rtl||this.rtl,greyScale:n.greyScale||this.greyScale,renderEngine:this.renderEngine,showLegend:!1,enableAnimations:!1,enableEvents:!1,showToolTips:!1,source:this.source,xAxis:a,seriesGroups:[{orientation:o?"horizontal":"vertical",valueAxis:{visible:!1},type:t.rangeSelector.serieType||"area",skipOverlappingPoints:m.jqx.getByPriority([t.rangeSelector.skipOverlappingPoints,!0]),columnSeriesOverlap:m.jqx.getByPriority([t.rangeSelector.columnSeriesOverlap,!1]),columnsGapPercent:m.jqx.getByPriority([t.rangeSelector.columnsGapPercent,25]),seriesGapPercent:m.jqx.getByPriority([t.rangeSelector.seriesGapPercent,25]),series:[{dataField:g,opacity:.8,lineWidth:1}]}]},f=(t.rangeSelector.seriesGroups&&(l.seriesGroups=t.rangeSelector.seriesGroups),t.rangeSelector.valueAxis&&(l.valueAxis=t.rangeSelector.valueAxis),l.showBorderLine||(l.borderLineWidth=1,l.borderLineColor=m.jqx.getByPriority([this.backgroundColor,this.background,"#FFFFFF"]),l.showBorderLine=!0),this),h=(f._supressBindingRefresh=!0,i.empty(),i.jqxChart(l),f._rangeSelectorInstances[e]=i,f._supressBindingRefresh=!1,i.on(f._getEvent("mousemove"),function(){f._unselect(),f._hideToolTip()}),i.jqxChart("getInstance"));h._plotRect&&((d=h._paddedRect).height=h._plotRect.height,o||"top"!=s?o&&(c=h._renderData[0].xAxis.rect.width,d.width-=c,"right"!=s&&(d.x+=c)):d.y+=h._renderData[0].xAxis.rect.height,f._createSliderElements(e,i,d,n),f.removeHandler(m(document),f._getEvent("mousemove")+"."+this.element.id,f._onSliderMouseMove),f.removeHandler(m(document),f._getEvent("mousedown"),f._onSliderMouseDown),f.removeHandler(m(document),f._getEvent("mouseup")+"."+this.element.id,f._onSliderMouseUp),f.addHandler(m(document),f._getEvent("mousemove")+"."+this.element.id,f._onSliderMouseMove,{self:this,groupIndex:e,renderTo:i,swapXY:o}),f.addHandler(m(i),f._getEvent("mousedown"),this._onSliderMouseDown,{self:this,groupIndex:e,renderTo:i,swapXY:o}),f.addHandler(m(document),f._getEvent("mouseup")+"."+this.element.id,f._onSliderMouseUp,{element:this.element.id,self:this,groupIndex:e,renderTo:i,swapXY:o}))},_createSliderElements:function(e,t,s,i){t.find(".slider").remove();var r=i.selectedRangeColor||"blue",o=m.jqx.getByPriority([i.selectedRangeOpacity,.1]),a=m.jqx.getByPriority([i.unselectedRangeOpacity,.5]),n=i.unselectedRangeColor||"white",i=i.rangeLineColor||"grey",l=m("<div class='slider' style='position: absolute;'></div>");for(l.css({background:r,opacity:o,left:s.x,top:s.y,width:s.width,height:s.height}),l.appendTo(t);this._sliders.length<e+1;)this._sliders.push({});r="<div class='slider' style='position: absolute;  background: "+n+"; opacity: "+a+";'></div>",o="<div class='slider' style='position: absolute; background:"+i+"; opacity: "+a+";'></div>",n="<div class='slider jqx-rc-all' style='position: absolute; background: white; border-style: solid; border-width: 1px; border-color: "+i+";'></div>";this._sliders[e]={element:l,host:t,_sliderInitialAbsoluteRect:{x:l.coord().left,y:l.coord().top,width:s.width,height:s.height},_hostInitialAbsolutePos:{x:t.coord().left,y:t.coord().top},getRect:function(){return{x:this.host.coord().left-this._hostInitialAbsolutePos.x+this._sliderInitialAbsoluteRect.x,y:this.host.coord().top-this._hostInitialAbsolutePos.y+this._sliderInitialAbsoluteRect.y,width:this._sliderInitialAbsoluteRect.width,height:this._sliderInitialAbsoluteRect.height}},rect:s,left:m(r),right:m(r),leftTop:m(o),rightTop:m(o),leftBorder:m(o),leftBar:m(n),rightBorder:m(o),rightBar:m(n)},this._sliders[e].left.appendTo(t),this._sliders[e].right.appendTo(t),this._sliders[e].leftTop.appendTo(t),this._sliders[e].rightTop.appendTo(t),this._sliders[e].leftBorder.appendTo(t),this._sliders[e].rightBorder.appendTo(t),this._sliders[e].leftBar.appendTo(t),this._sliders[e].rightBar.appendTo(t);a=this._renderData[e].xAxis.data.axisStats,i=a.min.valueOf(),r=a.max.valueOf(),o=this._valueToOffset(e,i),n=this._valueToOffset(e,r);n<o&&(t=n,n=o,o=t),"horizontal"!=this.seriesGroups[e].orientation?l.css({left:Math.round(s.x+o),top:s.y,width:Math.round(n-o),height:s.height}):l.css({top:Math.round(s.y+o),left:s.x,height:Math.round(n-o),width:s.width}),this._setSliderPositions(e,o,n)},_setSliderPositions:function(e,t,s){var i=this.seriesGroups[e],r=this._getXAxis(e),o=r.rangeSelector,i="horizontal"==i.orientation,r=(r.rangeSelector.renderTo&&(i=!1),r.position),o=(o.renderTo&&o.position&&(r=o.position),this._sliders[e]),e=i?"top":"left",a=i?"left":"top",n=i?"height":"width",l=i?"width":"height",d=i?"y":"x",h=i?"x":"y",c=o.rect,i=(o.startOffset=t,o.endOffset=s,o.left.css(e,c[d]),o.left.css(a,c[h]),o.left.css(n,t),o.left.css(l,c[l]),o.right.css(e,c[d]+s),o.right.css(a,c[h]),o.right.css(n,c[n]-s+1),o.right.css(l,c[l]),o.leftTop.css(e,c[d]),o.leftTop.css(a,c[h]+(i&&"right"==r||!i&&"top"!=r?0:c[l])),o.leftTop.css(n,t),o.leftTop.css(l,1),o.rightTop.css(e,c[d]+s),o.rightTop.css(a,c[h]+(i&&"right"==r||!i&&"top"!=r?0:c[l])),o.rightTop.css(n,c[n]-s+1),o.rightTop.css(l,1),o.leftBorder.css(e,c[d]+t),o.leftBorder.css(a,c[h]),o.leftBorder.css(n,1),o.leftBorder.css(l,c[l]),c[l]/4);(i=20<i?20:i)<3&&(i=3),o.leftBar.css(e,c[d]+t-3),o.leftBar.css(a,c[h]+c[l]/2-i/2),o.leftBar.css(n,5),o.leftBar.css(l,i),o.rightBorder.css(e,c[d]+s),o.rightBorder.css(a,c[h]),o.rightBorder.css(n,1),o.rightBorder.css(l,c[l]),o.rightBar.css(e,c[d]+s-3),o.rightBar.css(a,c[h]+c[l]/2-i/2),o.rightBar.css(n,5),o.rightBar.css(l,i)},_resizeState:{},_onSliderMouseDown:function(e){e.stopImmediatePropagation(),e.stopPropagation();var t=e.data.self;t._sliders[e.data.groupIndex]&&(null==t._resizeState.state&&t._testAndSetReadyResize(e),"ready"==t._resizeState.state&&((m.jqx._rangeSelectorTarget=t)._resizeState.state="resizing"))},_valueToOffset:function(e,t){var s=this.seriesGroups[e],i=this._sliders[e],r=i.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats,o=r.min.valueOf(),r=r.max.valueOf()-o,e=(0==r&&(r=1),this._getXAxis(e)),s="horizontal"==s.orientation?"height":"width",t=(t.valueOf()-o)/r;return i.getRect()[s]*(e.flip?1-t:t)},_offsetToValue:function(e,t){var s=this._sliders[e],i=this.seriesGroups[e],e=this._getXAxis(e),i="horizontal"==i.orientation?"height":"width",i=s.getRect()[i],s=(i=0==i?1:i,s.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats),r=s.min.valueOf(),o=s.max.valueOf(),a=t/i*(o-r)+r;return 1==e.flip&&(a=o-t/i*(o-r)),this._isDate(s.min)||this._isDate(s.max)?a=new Date(a):(a=(a=null!=e.dataField&&!s.useIndeces?a:Math.round(a))<s.min?s.min:a)>s.max&&(a=s.max),a},_onSliderMouseUp:function(e){var t=m.jqx._rangeSelectorTarget;if(t){var s=e.data.groupIndex,i=e.data.swapXY,r=t._sliders[s];if(r&&"resizing"==t._resizeState.state){e.stopImmediatePropagation(),e.stopPropagation(),t._resizeState={},t.host.css("cursor","default");var e=i?"top":"left",o=i?"y":"x",e=r.element.coord()[e],i=e+(i?r.element.height():r.element.width()),a=r.getRect(),n=t._offsetToValue(s,e-a[o]),l=t._offsetToValue(s,i-a[o]),d=(!r.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats.isTimeUnit&&864e5<l.valueOf()-n.valueOf()&&(n.setHours(0,0,0,0),l.setDate(l.getDate()+1),l.setHours(0,0,0,0)),t._getXAxis(s));d.flip&&(e=n,n=l,l=e);for(var h=0;h<t.seriesGroups.length;h++)t._getXAxis(h)==d&&(t._selectorRange[h]={min:n,max:l});t._isSelectorRefresh=!0;i=t.enableAnimations;t._raiseEvent("rangeSelectionChanging",{instance:t,minValue:n,maxValue:l}),t.enableAnimations=!1,t.update(),t.enableAnimations=i,t._raiseEvent("rangeSelectionChanged",{instance:t,minValue:n,maxValue:l})}}},_onSliderMouseMove:function(e){var t,s,i,r,o,a,n,l,d,h,c,g,p=e.data.self,u=(e.data.renderTo,e.data.groupIndex),f=p._sliders[u],_=e.data.swapXY;f&&(t=f.getRect(),s=f.element,i=m.jqx.position(e),r=s.coord(),o=_?"top":"left",a=_?"height":"width",n=_?"y":"x","resizing"==p._resizeState.state?(e.stopImmediatePropagation(),e.stopPropagation(),"left"==p._resizeState.side?(h=Math.round(i[o]-r[o]),c=t[n],r[o]+h>=c&&r[o]+h<=c+t[a]&&(d=parseInt(s.css(o)),g=Math.max(2,(_?s.height():s.width())-h),s.css(a,g),s.css(o,d+h))):"right"==p._resizeState.side?(l=_?s.height():s.width(),h=Math.round(i[o]-r[o]-l),c=t[n],r[o]+l+h>=c&&r[o]+h+l<=c+t[a]&&(g=Math.max(2,l+h),s.css(a,g))):"move"==p._resizeState.side&&(l=_?s.height():s.width(),d=parseInt(s.css(o)),h=Math.round(i[o]-p._resizeState.startPos),r[o]+h>=t[n]&&r[o]+h+l<=t[n]+t[a]&&(p._resizeState.startPos=i[o],s.css(o,d+h))),g=(c=parseInt(s.css(o))-f.rect[n])+(_?s.height():s.width()),p._setSliderPositions(u,c,g)):p._testAndSetReadyResize(e))},_testAndSetReadyResize:function(e){var t=e.data.self,s=e.data.renderTo,i=e.data.groupIndex,i=t._sliders[i],r=e.data.swapXY,o=i.getRect(),i=i.element,e=m.jqx.position(e),a=i.coord(),n=r?"left":"top",l=r?"top":"left",d=t._isTouchDevice?30:5;e[n]>=a[n]&&e[n]<=a[n]+o[r?"width":"height"]?Math.abs(e[l]-a[l])<=d?(s.css("cursor",r?"row-resize":"col-resize"),t._resizeState={state:"ready",side:"left"}):Math.abs(e[l]-a[l]-(r?i.height():i.width()))<=d?(s.css("cursor",r?"row-resize":"col-resize"),t._resizeState={state:"ready",side:"right"}):e[l]+d>a[l]&&e[l]-d<a[l]+(r?i.height():i.width())?(s.css("cursor","pointer"),t._resizeState={state:"ready",side:"move",startPos:e[l]}):(s.css("cursor","default"),t._resizeState={}):(s.css("cursor","default"),t._resizeState={})},_selectorGetSize:function(e){return e.rangeSelector.renderTo?0:e.rangeSelector.size||this._paddedRect.height/3}})}(jqxBaseFramework);
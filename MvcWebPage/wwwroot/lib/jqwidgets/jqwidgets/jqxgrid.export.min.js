!function(P){P.extend(P.jqx._jqxGrid.prototype,{_exportData:function(e,t,r){for(var n=this,s=(s="string"==typeof t?t:t.fileName)||"jqxGrid",s=new P.jqx.dataAdapter.DataExporter({exportHeader:(t=t&&"string"!=typeof t?t:{header:!0,filterBy:null,groupBy:null,style:null,fileName:s,pageOrientation:"portrait",expandChart:"+",collapseChar:"-"}).header}),l=(s.expandChar=t.expandChar,s.collapseChar=t.collapseChar,s.pageOrientation=t.pageOrientation,s.style=t.style,s.filterBy=t.filterBy,s.groupBy=t.groupBy,[]),o=n.columngroups||[],i=0,a=0;a<n.columns.records.length;a++)(x=n.columns.records[a]).exportable&&null!==n.columns.records[a].datafield&&(l[i++]={label:n.columns.records[a].text,dataField:n.columns.records[a].datafield});if(s.header={columns:l,columngroups:o},!t.style){var o=window.getComputedStyle(n.element),d=window.getComputedStyle(0<n.columns.records.length&&n.columns.records[0].element?n.columns.records[0].element:n.host.find(".jqx-grid-header")[0]),h=window.getComputedStyle(n.host.find(".jqx-grid-header")[0]);if(!(0===n.offsetWidth||0===n.offsetHeight)){function f(e){function i(e){return isNaN(e)?"00":o[(e-e%16)/16]+o[e%16]}function t(e){var t,r,s,l,o;return-1!=e.toString().indexOf("rgba")?(l=a.split(","),t=parseInt(l[0].substring(5)),r=parseInt(l[1]),s=parseInt(l[2]),l=l[3]?parseFloat(l[3].substring(1,4)):1,o=n._rgbToHex({r:t,g:r,b:s}),0==t&&0==r&&0==s&&0==l?"#ffffff":"#"+o):(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+i(e[1])+i(e[2])+i(e[3]).toUpperCase():"#ffffff"}var r=e.fontSize,s=e.borderRightColor,l=e.backgroundColor,a=e.color,o=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return{borderColor:t(s),fontSize:r,fontFamily:"Helvetica",color:t(a),backgroundColor:t(l)}}for(var c,o=f(o),d=f(d),h=f(h),g={height:"30px",border:"1px solid "+o.borderColor,fontFamily:h.fontFamily,fontSize:h.fontSize,color:h.color,backgroundColor:d.backgroundColor,fontWeight:"400"},u={border:"1px solid "+o.borderColor,fontFamily:o.fontFamily,fontSize:o.fontSize},h={height:n.rowsheight+"px"},a=0;a<n.columns.records.length;a++)(x=n.columns.records[a]).exportable&&(g[x.datafield]={textAlign:x.align,width:x.width+"px",format:x.cellsformat||""},c=x.cellsformat||"","date"===x.dataType?c="d":"dateTime"===x.dataType?c="D":"time"===x.dataType&&(c="t"),c={textAlign:x.cellsalign,format:c},u[x.datafield]=c);n.altrows&&(h.alternationCount=2,h.alternationStart=0,h.alternationEnd=0,h.alternationIndex0Color=o.color,h.alternationIndex0BackgroundColor=o.backgroundColor,h.alternationIndex1Color=o.color,h.alternationIndex1BackgroundColor="#F5F5F5"),s.style={border:"1px solid "+o.borderColor,borderCollapse:"collapse",header:g,columns:u,rows:h}}}for(var p=r||this.getrows(),m=[],a=0;a<p.length;a++){var y=p[a];if(!y.hidden){for(var x,b={},w=0;w<n.columns.records.length;w++)(x=n.columns.records[w]).exportable&&(b[x.datafield]=y[x.datafield]);m.push(b)}}return!t.groupBy&&n.groups&&(s.groupBy=n.groups.slice(0)),s.exportData(m,e,t.fileName,null)},exportview:function(e,t,r){this._exportData(e,t,r)},exportdata:function(h,e,f,c,t,r,s){if(!P.jqx.dataAdapter.ArrayExporter)throw"jqxGrid: Missing reference to jqxdata.export.js!";if("xlsx"===h)this._exportData("xlsx",e);else{null==f&&(f=!0);var g=this;if(null==c)if(0==(c=this.getrows()).length)throw"No data to export.";this.exporting=!0,this.pageable||(this.loadondemand=!0),this.altrows&&this._renderrows(this.virtualsizeinfo);for(var u,l=this.hScrollInstance.value,p=(this.hScrollInstance.setPosition(0),this._renderrows(this.virtualsizeinfo),null!=t&&t),m={},y={},t=this.host.find(".jqx-grid-cell:first"),o=this.host.find(".jqx-grid-cell-alt:first"),x=(t.removeClass(this.toThemeProperty("jqx-grid-cell-selected")),t.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),o.removeClass(this.toThemeProperty("jqx-grid-cell-selected")),o.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),t.removeClass(this.toThemeProperty("jqx-grid-cell-hover")),t.removeClass(this.toThemeProperty("jqx-fill-state-hover")),o.removeClass(this.toThemeProperty("jqx-grid-cell-hover")),o.removeClass(this.toThemeProperty("jqx-fill-state-hover")),"cell"),b=1,w=1,v=[],i=0;i<this.columns.records.length;i++){var a=this.columns.records[i];if(""!=a.cellclassname)if(a.customCellStyles=new Array,"string"==typeof a.cellclassname)for(var n=0;n<c.length;n++)a.customCellStyles[n]=a.cellclassname;else for(n=0;n<c.length;n++){var d=this.getrowboundindex(n),d=a.cellclassname(d,a.displayfield,c[n][a.displayfield],c[n]);d&&(a.customCellStyles[n]=d)}}var C,S,T,j=new Array,q=null,F=null,_=null,I=(P.each(this.columns.records,function(e){function t(e){if(e.removeClass(g.toThemeProperty("jqx-grid-cell-selected")),e.removeClass(g.toThemeProperty("jqx-fill-state-pressed")),e.removeClass(g.toThemeProperty("jqx-grid-cell-hover")),e.removeClass(g.toThemeProperty("jqx-fill-state-hover")),s.customCellStyles)for(var t in s.customCellStyles)e.removeClass(s.customCellStyles[t])}var r=P(g.table[0].rows[0].cells[e]),s=(1<g.table[0].rows.length&&(l=P(g.table[0].rows[1].cells[e]),_=_||l),F=F||r,this);if(t(r),l&&t(l),null==this.displayfield)return!0;g.showaggregates&&g.getcolumnaggregateddata&&v.push(g.getcolumnaggregateddata(this.displayfield,this.aggregates,!0,c));var l,o,d=g._getexportcolumntype(this),i=(!this.exportable||this.hidden&&!p||(m[this.displayfield]={},m[this.displayfield].text=this.text,m[this.displayfield].width=parseInt(this.width),isNaN(m[this.displayfield].width)&&(m[this.displayfield].width=60),m[this.displayfield].formatString=this.cellsformat,m[this.displayfield].localization=g.gridlocalization,m[this.displayfield].type=d,m[this.displayfield].cellsAlign=this.cellsalign,m[this.displayfield].hidden=!f,m[this.displayfield].displayfield=this.displayfield,j.push(m[this.displayfield])),x="cell"+b,P(this.element));if(null==this.element&&(i=P(this.uielement)),q?s._rendered||(i=q,r=F,l=_,o=g.toTP("jqx-grid-cell")+" "+g.toTP("jqx-item"),r[0].className=o,o+=g.toTP("jqx-grid-cell-alt"),l&&(l[0].className=o)):q=i,u="column"+w,"html"==h||"xls"==h||"pdf"==h){function a(e,t,r,s,l,o,i,a,n){y[e]={},null!=t&&(0==t[0].offsetWidth||0==t[0].offsetHeight?r||(y[e].dataType=d):(y[e]["font-size"]=t.css("font-size"),y[e]["font-weight"]=t.css("font-weight"),y[e]["font-style"]=t.css("font-style"),y[e]["background-color"]=o._getexportcolor(t.css("background-color")),y[e].color=o._getexportcolor(t.css("color")),y[e]["border-color"]=o._getexportcolor(t.css("border-top-color")),r?y[e]["text-align"]=l.align:(y[e]["text-align"]=l.cellsalign,y[e].formatString=l.cellsformat,y[e].dataType=d),"html"!=h&&"pdf"!=h||(y[e]["border-top-width"]=t.css("border-top-width"),y[e]["border-left-width"]=t.css("border-left-width"),y[e]["border-right-width"]=t.css("border-right-width"),y[e]["border-bottom-width"]=t.css("border-bottom-width"),y[e]["border-top-style"]=t.css("border-top-style"),y[e]["border-left-style"]=t.css("border-left-style"),y[e]["border-right-style"]=t.css("border-right-style"),y[e]["border-bottom-style"]=t.css("border-bottom-style"),r?(0==i&&(y[e]["border-left-width"]=t.css("border-right-width")),y[e]["border-top-width"]=t.css("border-right-width"),y[e]["border-bottom-width"]=t.css("border-bottom-width")):0==i&&(y[e]["border-left-width"]=t.css("border-right-width")),y[e].height=t.css("height")),!l.exportable||l.hidden&&!p||(1==a?(m[l.displayfield].customCellStyles||(m[l.displayfield].customCellStyles=new Array),m[l.displayfield].customCellStyles[n]=e):r?m[l.displayfield].style=e:s?m[l.displayfield].cellAltStyle=e:m[l.displayfield].cellStyle=e)))}if(a(u,i,!0,!1,this,g,e),w++,a(x,r,!1,!1,this,g,e),g.altrows&&a(x="cellalt"+b,l,!1,!0,this,g,e),this.customCellStyles){for(var n in s.customCellStyles)r.removeClass(s.customCellStyles[n]);for(var n in s.customCellStyles)r.addClass(s.customCellStyles[n]),a(x+s.customCellStyles[n],r,!1,!1,this,g,e,!0,n),r.removeClass(s.customCellStyles[n])}b++}}),P.each(this.columns.records,function(e){m[this.displayfield]&&(m[this.displayfield].columnsDataFields=j)}),this.showaggregates&&(C=[],S="xls"==h?"_AG":"",T=this.groupable?this.groups.length:0,this.rowdetails&&T++,"checkbox"===this.selectionmode&&T++,0<v.length&&(P.each(this.columns.records,function(e){if(this.aggregates)for(var t,r,s,l=0;l<this.aggregates.length;l++)C[l]||(C[l]={}),C[l]&&(t=g._getaggregatename(this.aggregates[l]),r=g._getaggregatetype(this.aggregates[l]),(s=v[e-T])&&(C[l][this.displayfield]=S+t+": "+s[r]))}),P.each(this.columns.records,function(e){for(var t=0;t<C.length;t++)null==C[t][this.displayfield]&&(C[t][this.displayfield]=S)})),P.each(C,function(){c.push(this)})),this),t=P.jqx.dataAdapter.ArrayExporter(c,m,y);if(null==e)return this._renderrows(this.virtualsizeinfo),o=t.exportTo(h),this.showaggregates&&P.each(C,function(){c.pop(this)}),setTimeout(function(){I.exporting=!1},50),this.hScrollInstance.setPosition(l),this._renderrows(this.virtualsizeinfo),o;t.exportToFile(h,e,r,s),this.showaggregates&&P.each(C,function(){c.pop(this)}),this._renderrows(this.virtualsizeinfo),setTimeout(function(){I.exporting=!1},50),this.hScrollInstance.setPosition(l),this._renderrows(this.virtualsizeinfo)}},_getexportcolor:function(e){e="transparent"==e?"#FFFFFF":e;if(-1==(e=e&&e.toString()?e:"#FFFFFF").toString().indexOf("rgb"))return-1!=e.toString().indexOf("#")&&4==e.toString().length&&(t=e.toString().substring(1,4),e+=t),e;var t=e.split(",");if(-1!=e.toString().indexOf("rgba"))return r=parseInt(t[0].substring(5)),s=parseInt(t[1]),l=parseInt(t[2]),e=parseFloat(t[3].substring(1,4)),o=this._rgbToHex(i={r:r,g:s,b:l}),0==r&&0==s&&0==l&&0==e?"#ffffff":"#"+o;var r,s,l,o,i={r:r=parseInt(t[0].substring(4)),g:s=parseInt(t[1]),b:l=parseInt(t[2].substring(1,4))};return"#"+(o=this._rgbToHex(i))},_rgbToHex:function(e){return this._intToHex(e.r)+this._intToHex(e.g)+this._intToHex(e.b)},_intToHex:function(e){e=parseInt(e).toString(16);return(e=1==e.length?"0"+e:e).toUpperCase()},_getexportcolumntype:function(e){var t="string",r=this.source.datafields||(this.source._source?this.source._source.datafields:null);if(r){var s="";if(P.each(r,function(){if(this.name==e.displayfield)return this.type&&(s=this.type),!1}),s)return s}if(null!=e){if(null==this.dataview.cachedrecords)return t;var l=null;if(this.virtualmode)P.each(this.dataview.cachedrecords,function(){return l=this[e.displayfield],!1});else{if(0==this.dataview.cachedrecords.length)return t;if(null!=(l=this.dataview.cachedrecords[0][e.displayfield])&&""==l.toString())return"string"}if(null!=l){if(-1!=e.cellsformat.indexOf("c"))return"number";if(-1!=e.cellsformat.indexOf("n"))return"number";if(-1!=e.cellsformat.indexOf("p"))return"number";if(-1!=e.cellsformat.indexOf("d"))return"date";if(-1!=e.cellsformat.indexOf("y"))return"date";if(-1!=e.cellsformat.indexOf("M"))return"date";if(-1!=e.cellsformat.indexOf("m"))return"date";if(-1!=e.cellsformat.indexOf("t"))return"date";if("boolean"==typeof l)t="boolean";else if(P.jqx.dataFormat.isNumber(l))t="number";else{var r=new Date(l);if("NaN"==r.toString()||"Invalid Date"==r.toString())if(P.jqx.dataFormat){if(null!=(r=P.jqx.dataFormat.tryparsedate(l))){if(r&&r.getFullYear())if(1970==r.getFullYear()&&0==r.getMonth()&&1==r.getDate())return r=new Number(l),isNaN(r)?"string":"number";return"date"}t="string"}else t="string";else t="date"}}}return t}})}(jqxBaseFramework);
!function(D){D.extend(D.jqx._jqxGrid.prototype,{savestate:function(i){var s=this.getstate();return void 0===i||D.isEmptyObject(i)||(-1==i.indexOf("sort")&&(delete s.sortcolumn,delete s.sortdirection),-1==i.indexOf("pager")&&(delete s.pagenum,delete s.pagesizeoptions,delete s.pagesize),-1==i.indexOf("selection")&&(delete s.selectedcells,delete s.selectedrowindexes,delete s.selectedrowindex),-1==i.indexOf("grouping")&&delete s.groups,-1==i.indexOf("filter")&&delete s.filters,D.each(this.columns.records,function(e){var t=s.columns[this.datafield];-1==i.indexOf("hidden_columns")&&delete t.hidden,-1==i.indexOf("reorder")&&delete t.index,-1==i.indexOf("columns_width")&&delete t.width,-1==i.indexOf("columns_text")&&delete t.text,-1==i.indexOf("alignment")&&(delete t.align,delete t.cellsalign)})),window.localStorage&&(window.localStorage["jqxGrid"+this.element.id]=this._stringify(s)),this._savedstate=s},loadstate:function(e,t){var i="";if(null!=e&&null!=e.width?i=e:window.localStorage?window.localStorage["jqxGrid"+this.element.id]&&(i=D.parseJSON(window.localStorage["jqxGrid"+this.element.id])):this._savedstate&&(i=this._savedstate),null!=i&&""!==i){(this.virtualmode||this.source._source.url&&""!=this.source._source.url)&&this.source.beginUpdate();e=i;if(void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height),this.pageable&&(null!=e.pagesize&&(this.pagesize=e.pagesize,this.dataview.pagesize=e.pagesize),null!=e.pagenum&&(this.dataview.pagenum=e.pagenum),null!=e.pagesizeoptions&&(this.pagesizeoptions=e.pagesizeoptions),this.pagesizeoptions)){for(var s=0,r=0;r<this.pagesizeoptions.length;r++)this.pagesize>=this.pagesizeoptions[r]&&(s=r);this.pagershowrowscombo&&this.pagershowrowscombo.jqxDropDownList({selectedIndex:s})}this.sortable&&(this._loading&&(this._loading=!1),e.sortdirection?(e.sortdirection.ascending||e.sortdirection.descending)&&(this.dataview.sortfield=e.sortcolumn,i=e.sortdirection.ascending?"asc":"desc",this.dataview.sortfielddirection=i,this.source.sortcolumn=e.sortcolumn,this.source.sortdirection=i,this.sortby(e.sortcolumn,i)):null==this.dataview.sortfield||"asc"!=this.dataview.sortfielddirection&&"desc"!=this.dataview.sortfielddirection||this.sortby(this.dataview.sortfield,null)),this.groupable&&e.groups&&(this.dataview.groups=e.groups,this.groups=e.groups),this.loadingstate=!0,this.virtualsizeinfo&&this._loadselectionandcolumnwidths(e),this.loadingstate=!1,(this.virtualmode||this.source._source.url&&""!=this.source._source.url)&&(1==t?this.source.endUpdate(!1):(this.source.endUpdate(!1),(this.virtualmode||this.source._source.filter||this.source._source.sort)&&this.updatebounddata("state")))}},_loadselectionandcolumnwidths:function(e){this.loadingstate=!0;var t="";if(null!=e&&null!=e.width?t=e:window.localStorage?window.localStorage["jqxGrid"+this.element.id]&&(t=D.parseJSON(window.localStorage["jqxGrid"+this.element.id])):this._savedstate&&(t=this._savedstate),null!=t&&""!=t){var e=this._loading,s=(this._loading=!1,t),l=this,r=!1,o=[];o.length=0;if(D.each(this.columns.records,function(e){var t=s.columns[this.datafield];if(null!=t){if(this.text!=t.text&&(r=!0),this.hidden!=t.hidden&&(r=!0),void 0!==t.width&&(this.width=t.width,this._width&&(this._width=null),this._percentagewidth&&(this._percentagewidth=null)),void 0!==t.hidden&&(this.hidden=t.hidden),void 0!==t.pinned&&(this.pinned=t.pinned),void 0!==t.groupable&&(this.groupable=t.groupable),void 0!==t.resizable&&(this.resizable=t.resizable),this.draggable=t.draggable,void 0!==t.text&&(this.text=t.text),void 0!==t.align&&(this.align=t.align),void 0!==t.cellsalign&&(this.cellsalign=t.cellsalign),l._columns)for(var i=0;i<l._columns.length;i++)l._columns[i].datafield==this.datafield&&(void 0!==t.hidden&&(l._columns[i].hidden=t.hidden),void 0!==t.width&&(l._columns[i].width=t.width));void 0!==t.index&&(o[this.datafield]=t.index,o.length++)}}),0<o.length){if(this.setcolumnindex){this.rowdetails;this.groupable&&this.groups.length;for(var i=new Array,n=0;n<this.columns.records.length;n++)i.push(this.columns.records[n]);for(var a=0,d=new Array,n=0;n<i.length;n++){var h,c=i[n],u=o[c.datafield];this.groupable&&c.grouped?a++:0==n&&this.rowdetails?a++:(n!==u||this.groupable||this.rowdetails)&&(h=a+u,d.push({column:c,key:h}))}d.sort(function(e,t){return e.key<t.key?-1:e.key>t.key?1:0}),d.reverse(),D.each(d,function(e,t){var i=this.key;l.setcolumnindex(this.column.datafield,i,!1)})}this.prerenderrequired=!0,this.groupable&&this._refreshdataview(),this.rendergridcontent(!0),this._updatefilterrowui&&this.filterable&&this.showfilterrow&&this._updatefilterrowui(),this._renderrows(this.virtualsizeinfo)}if(this.filterable&&void 0!==s.filters){this.clearfilters&&(this._loading=!1,this.clearfilters(!1));for(var f="",g=new D.jqx.filter,n=0;n<s.filters.filterscount;n++){var p=s.filters["filtercondition"+n],w=s.filters["filterdatafield"+n],c=this.getcolumn(w);if(w!=f&&(g=new D.jqx.filter),f=w,c&&c.filterable){var v=s.filters["filtervalue"+n],m=s.filters["filteroperator"+n];if(b="datefilter"==(_=s.filters["filtertype"+n])?g.createfilter(_,v,p,null,c.cellsformat,this.gridlocalization):g.createfilter(_,v,p),g.addfilter(m,b),this.showfilterrow){var x,_,b,y,j,q=c._filterwidget,z=c._filterwidget.parent();if(null!=q)switch(c.filtertype){case"number":z.find("input").val(v),this.host.jqxDropDownList&&(x=g.getoperatorsbyfiltertype("numericfilter"),q.find(".filter").jqxDropDownList("selectIndex",x.indexOf(p)));break;case"date":this.host.jqxDateTimeInput?D(z.children()[0]).jqxDateTimeInput("setDate",v):q.val(v);break;case"range":this.host.jqxDateTimeInput?(x=s.filters["filtervalue"+(n+1)],_=s.filters["filtertype"+n],b=g.createfilter(_,x,"LESS_THAN_OR_EQUAL"),g.addfilter(m,b),j=new Date(v),y=new Date(x),isNaN(j)&&(j=D.jqx.dataFormat.tryparsedate(v)),isNaN(y)&&(y=D.jqx.dataFormat.tryparsedate(v)),D(z.children()[0]).jqxDateTimeInput("setRange",j,y),n++):q.val(v);break;case"textbox":case"default":q.val(v),l["_oldWriteText"+q[0].id]=v;break;case"list":this.host.jqxDropDownList?(j=D(z.children()[0]).jqxDropDownList("getItems"),u=-1,D.each(j,function(e){if(this.value==v)return u=e,!1}),D(z.children()[0]).jqxDropDownList("selectIndex",u)):q.val(v);break;case"checkedlist":this.host.jqxDropDownList||q.val(v);break;case"bool":case"boolean":this.host.jqxCheckBox?D(z.children()[0]).jqxCheckBox({checked:v}):q.val(v)}}this.addfilter(w,g)}}s.filters&&0<s.filters.filterscount&&(this.applyfilters(),this.showfilterrow&&D.each(this.columns.records,function(){if("checkedlist"==this.filtertype&&this.filterable&&l.host.jqxDropDownList){var e=this,t=e._filterwidget,i=(t.jqxDropDownList("getItems"),t.jqxDropDownList("listBox"));if(i.checkAll(!1),e.filter){i.uncheckAll(!1);for(var s=e.filter.getfilters(),r=0;r<i.items.length;r++){var o=i.items[r].label;D.each(s,function(){if("NOT_EQUAL"==this.condition)return!0;o==this.value&&i.checkIndex(r,!1,!1)})}i._updateCheckedItems();t=i.getCheckedItems().length;i.items.length!=t&&0<t&&i.host.jqxListBox("indeterminateIndex",0,!0,!1)}}})),this.pageable&&void 0!==s.pagenum&&(this.gotopage&&!this.virtualmode?(this.dataview.pagenum=-1,this.gotopage(s.pagenum)):this.gotopage&&this.virtualmode&&this.gotopage(s.pagenum))}if(s.selectedrowindexes&&s.selectedrowindexes&&0<s.selectedrowindexes.length&&(this.selectedrowindexes=s.selectedrowindexes,this.selectedrowindex=s.selectedrowindex,"checkbox"===this.selectionmode&&this._updatecheckboxselection()),s.selectedcells&&this._applycellselection&&D.each(s.selectedcells,function(){l._applycellselection(this.rowindex,this.datafield,!0,!1)}),this.groupable&&void 0!==s.groups)return this._refreshdataview(),this.render(),this._loading=e,void(this.loadingstate=!1);if(r){if(this.prerenderrequired=!0,this.rendergridcontent(!0),this._loading=e,this.loadingstate=!1,this.updating())return!1}else this._loading=e,this._updatecolumnwidths(),this._updatecellwidths(),this.loadingstate=!1;this.loadingstate=!1,this._loading=e,this._renderrows(this.virtualsizeinfo)}this.loadingstate=!1},getstate:function(){var e,t=this.getdatainformation(),s={},i=(s.width=this.width,s.height=this.height,s.pagenum=t.paginginformation.pagenum,s.pagesize=t.paginginformation.pagesize,s.pagesizeoptions=this.pagesizeoptions,s.sortcolumn=t.sortinformation.sortcolumn,s.sortdirection=t.sortinformation.sortdirection,null!=this.selectionmode&&this.getselectedcells&&(-1!=this.selectionmode.toString().indexOf("cell")?(t=this.getselectedcells(),e=new Array,D.each(t,function(){e.push({datafield:this.datafield,rowindex:this.rowindex})}),s.selectedcells=e):(t=this.getselectedrowindexes(),s.selectedrowindexes=t,s.selectedrowindex=this.selectedrowindex)),{}),r=0;if(this.dataview.filters)for(var o=0;o<this.dataview.filters.length;o++){var l=this.dataview.filters[o].datafield,n=this.dataview.filters[o].filter,a=n.getfilters();i[l+"operator"]=n.operator;for(var d,h=0;h<a.length;h++)a[h].datafield=l,"datefilter"==a[h].type&&a[h].value&&a[h].value.toLocaleString?(d=this.getcolumn(a[h].datafield)).cellsformat?(d=this.source.formatDate(a[h].value,d.cellsformat,this.gridlocalization),i["filtervalue"+r]=d||a[h].value.toLocaleString()):i["filtervalue"+r]=a[h].value.toLocaleString():i["filtervalue"+r]=a[h].value,i["filtercondition"+r]=a[h].condition,i["filteroperator"+r]=a[h].operator,i["filterdatafield"+r]=l,i["filtertype"+r]=a[h].type,r++}i.filterscount=r,s.filters=i,s.groups=this.groups,s.columns={};var c=0;return this.columns.records&&D.each(this.columns.records,function(e,t){if(!this.datafield)return!0;var i={};i.width=this.width,i.hidden=this.hidden,i.pinned=this.pinned,i.groupable=this.groupable,i.resizable=this.resizable,i.draggable=this.draggable,i.text=this.text,i.align=this.align,i.cellsalign=this.cellsalign,i.index=c++,s.columns[this.datafield]=i}),s},_stringify:function(t){if(window.JSON&&"function"==typeof window.JSON.stringify){var e="";try{e=window.JSON.stringify(t)}catch(e){return this._str("",{"":t})}return e}return e=this._str("",{"":t})},_quote:function(e){var i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return'"'+e.replace(/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'},_stringifyArray:function(e){for(var t=e.length,i=[],s=0;s<t;s++)i.push(this._str(s,e)||"null");return"["+i.join(",")+"]"},_stringifyObject:function(e){var t,i,s=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i=this._str(t,e))&&s.push(this._quote(t)+":"+i);return"{"+s.join(",")+"}"},_stringifyReference:function(e){return"[object Array]"===Object.prototype.toString.call(e)?this._stringifyArray(e):this._stringifyObject(e)},_stringifyPrimitive:function(e,t){switch(t){case"string":return this._quote(e);case"number":return isFinite(e)?e:"null";case"boolean":return e}return"null"},_str:function(e,t){var t=t[e],i=typeof t;return t&&"object"==typeof t&&"function"==typeof t.toJSON&&(i=typeof(t=t.toJSON(e))),/(number|string|boolean)/.test(i)||!t&&"object"===i?this._stringifyPrimitive(t,i):this._stringifyReference(t)}})}(jqxBaseFramework);
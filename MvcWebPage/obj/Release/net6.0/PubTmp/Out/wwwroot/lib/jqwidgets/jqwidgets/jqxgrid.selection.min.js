!function(K){K.extend(K.jqx._jqxGrid.prototype,{selectallrows:function(){this._trigger=!1;for(var e=this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length,t=(this.selectedrowindexes=new Array,this.selectedcells=new Array,this.dataview.loadedrecords),l=0;l<e;l++){var i=t[l];if(i){var s=this.getboundindex(i);null!=s&&(this.selectedrowindexes[l]=s);for(var o=0;o<this.columns.records.length;o++)this.selectedcells[s+"_"+this.columns.records[o].datafield]=!0}else this.selectedrowindexes[l]=l}"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},unselectallrows:function(){this._trigger=!1;this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=new Array,this.selectedcells=new Array,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},selectrow:function(e,t){"none"!==this.selectionmode&&(this._applyrowselection(e,!0,t),!1!==t&&this._updatecheckboxselection())},_updatecheckboxselection:function(){var e,t;"checkbox"==this.selectionmode&&(e=this.getrows())&&this._checkboxcolumn&&(0===e.length?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}):(e=e.length,this.groupable&&(e=this.dataview.loadedrecords.length),this.virtualmode&&(e=this.source._source.totalrecords),(t=this.selectedrowindexes.length)===e?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}):0===t?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}):this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:null})))},unselectrow:function(e,t){this._applyrowselection(e,!1,t),!1!==t&&this._updatecheckboxselection()},selectcell:function(e,t){this._applycellselection(e,t,!0)},unselectcell:function(e,t){this._applycellselection(e,t,!1)},clearselection:function(e,t){if(this._trigger=!1,this.selectedrowindex=-1,this._oldselectedcell=null,!1!==t)for(var l=0;l<this.selectedrowindexes.length;l++)this._raiseEvent(3,{rowindex:this.selectedrowindexes[l]});this.selectedrowindexes=new Array,this.selectedcells=new Array,this.selectedcell=null,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});for(l=0;l<this.columns.records.length;l++)this.columns.records[l].selected=!1,this.columns.records[l]._applyStyle();!1===e?this._trigger=!0:(this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(3,{rowindex:this.selectedrowindexes}))},getselectedrowindex:function(){if(-1==this.selectedrowindex||null==this.selectedrowindex){var e=0;if(e<this.selectedrowindexes.length)return this.selectedrowindexes[e]}return this.selectedrowindex},getselectedrowindexes:function(){return this.selectedrowindexes},getselectedcell:function(){if(!this.selectedcell)return null;var e=this.selectedcell;return e.row=this.selectedcell.rowindex,e.column=this.selectedcell.datafield,e.value=this.getcellvalue(e.row,e.column),e},getselectedcells:function(){var e,t=new Array;for(e in this.selectedcells)t[t.length]=this.selectedcells[e];return t},getselection:function(){return{cells:this.getselectedcells(),rows:this.getselectedrowindexes()}},_getcellsforcopypaste:function(){var e=new Array;if(-1==this.selectionmode.indexOf("cell"))for(var t=this.selectedrowindexes,l=0;l<t.length;l++)for(var i,s=t[l],o=0;o<this.columns.records.length;o++)"_checkboxcolumn"!==this.columns.records[o].datafield&&(this.columns.records[o].datafield,i={rowindex:s,datafield:this.columns.records[o].datafield},e.push(i));return e},deleteselection:function(){var e=this,t=e.getselectedcells();if(null!=(t=-1==this.selectionmode.indexOf("cell")?this._getcellsforcopypaste():t)&&0<t.length){for(var l=0;l<t.length;l++){var i,s=t[l],o=e.getcolumn(s.datafield),a=e.getcellvalue(s.rowindex,s.datafield);o&&""!==a&&(i=null,"checkbox"!=o.columntype||o.threestatecheckbox||(i=!1),e._raiseEvent(17,{rowindex:s.rowindex,datafield:s.datafield,value:a}),l==t.length-1?e.setcellvalue(s.rowindex,s.datafield,i,!0):e.setcellvalue(s.rowindex,s.datafield,i,!1),o.displayfield!=o.datafield&&e.setcellvalue(s.rowindex,o.displayfield,i,!0),e._raiseEvent(18,{rowindex:s.rowindex,datafield:s.datafield,oldvalue:a,value:i}))}this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}},copyselection:function(){var l="",i=this,e=(this.clipboardselection={},this.logicalclipboardselection={},this._clipboardselection=[],i.getselectedcells()),t=(-1==this.selectionmode.indexOf("cell")&&(e=this._getcellsforcopypaste()),new Array);if(null!=e&&0<e.length){for(var s=999999999999999,o=-1,a=0;a<e.length;a++){var r,n,d=e[a],c=i.getcolumn(d.datafield);null==c||!c.clipboard||c.hidden&&!this.copytoclipboardhiddencolumns||(-1==t.indexOf(c.text)&&t.push(c.text),r=i.getcelltext(d.rowindex,c.displayfield),n=this.getrowdisplayindex(d.rowindex),this.clipboardselection[n]||(this.clipboardselection[n]={}),this.clipboardselection[n][c.displayfield]=r,this.logicalclipboardselection[n]||(this.logicalclipboardselection[n]={}),this.logicalclipboardselection[n][c.displayfield]=r,c.displayfield!=c.datafield&&(this.logicalclipboardselection[n][c.datafield]=i.getcellvalue(d.rowindex,c.datafield)),s=Math.min(s,n),o=Math.max(o,n))}for(var h,u=new Array,f=s;f<=o;f++)this.logicalclipboardselection[f]&&(h=K.extend({},this.logicalclipboardselection[f]),u.push(h));if(this.logicalclipboardselection=u,this.copytoclipboardwithheaders){for(var p=0;p<t.length;p++)0<p&&(l+="\t"),l+=t[p];l+="\r\n"}for(f=s;f<=o;f++){var g=0;this._clipboardselection[this._clipboardselection.length]=new Array,null!=this.clipboardselection[f]&&(K.each(this.clipboardselection[f],function(e,t){0<g&&(l+="\t");t=null==t?"":t;i._clipboardselection[i._clipboardselection.length-1][g]=t,g++,l+=t}),f<o&&(l+="\r\n"))}}return this.clipboardselectedtext=l},pasteselection:function(){var e=this.getselectedcells();if((this._oldselectedcell=null)!=(e=-1==this.selectionmode.indexOf("cell")?this._getcellsforcopypaste():e)&&0<e.length){var t=e[0].rowindex,l=this.getrowdisplayindex(t),t=e[0].datafield,i=this._getcolumnindex(t),s=(this.selectedrowindexes=new Array,this.selectedcells=new Array,e.length,0),o=new Array,a=[];this.copytoclipboardwithheaders&&this._clipboardselection.splice(0,1),this._clipboardselection||(this._clipboardselection=[]);for(var r=0;r<this._clipboardselection.length;r++){s+=this._clipboardselection[r].length,o[r]=new Array;for(var n=0;n<this._clipboardselection[r].length;n++){var d=this._clipboardselection[r][n];o[r].push(d)}}if(s<e.length){for(var c=new Array,r=0;r<e.length;r++)c[(x=e[r]).rowindex]||(c[x.rowindex]=new Array),c[x.rowindex].push(x);for(var h=0,u=0,r=0;r<c.length;r++)if(c[r]){for(n=0;n<c[r].length;n++){var f=(x=c[r][n]).rowindex,p=this.getcolumn(x.datafield);if("_checkboxcolumn"!==p.datafield&&!p.hidden){d="";if(o[h]&&null==o[h][u]&&(u=0),d=""+o[h][u],u++,p.cellsformat&&(-1!=p.cellsformat.indexOf("p")||-1!=p.cellsformat.indexOf("d")||-1!=p.cellsformat.indexOf("c")||-1!=p.cellsformat.indexOf("n")||-1!=p.cellsformat.indexOf("f"))){-1<(d=(d=function(e,t,l){var i=e;if(t==l)return e;for(var s=i.indexOf(t);-1!=s;)s=(i=i.replace(t,l)).indexOf(t);return i}(d=d.indexOf&&-1<d.indexOf(this.gridlocalization.currencysymbol)?d.replace(this.gridlocalization.currencysymbol,""):d,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(d=d.replace(this.gridlocalization.percentsymbol,""));for(var g="",w=0;w<d.length;w++)"-"===(b=d.substring(w,w+1))&&(g+="-"),"."===b&&(g+="."),null!=b.match(/^[0-9]+$/)&&(g+=b);d=(d=g).replace(/ /g,""),d=new Number(d),isNaN(d)&&(d="")}this._raiseEvent(17,{rowindex:f,datafield:x.datafield,value:d});var m=this.getrowdata(f);a.push({oldvalue:m[x.datafield],value:d,datafield:x.datafield,row:f}),this.pushToHistory=!0,this.setcellvalue(f,p.displayfield,d,!1),this.pushToHistory=!1,p.displayfield!=p.datafield&&this.logicalclipboardselection&&this.logicalclipboardselection[f]&&null!=(_=this.logicalclipboardselection[f][p.datafield])&&this.setcellvalue(f,p.datafield,_,!1),this._raiseEvent(18,{rowindex:f,datafield:x.datafield,oldvalue:this.getcellvalue(x.rowindex,x.datafield),value:d}),this._applycellselection(f,x.datafield,!0,!1)}}u=0,o[++h]||(h=0)}}else{if(!this._clipboardselection)return;for(m=0;m<this._clipboardselection.length;m++)for(var v=0;v<this._clipboardselection[m].length;v++){p=this.getcolumnat(i+v);if(p&&("_checkboxcolumn"!==p.datafield&&!p.hidden)){var f=this.getrowboundindex(l+m),x=this.getcell(f,p.datafield),d=null;if(null!=(d=this._clipboardselection[m][v])){if(p.cellsformat&&(-1!=p.cellsformat.indexOf("p")||-1!=p.cellsformat.indexOf("d")||-1!=p.cellsformat.indexOf("c")||-1!=p.cellsformat.indexOf("n")||-1!=p.cellsformat.indexOf("f"))){-1<(d=(d=function(e,t,l){var i=e;if(t==l)return e;for(var s=i.indexOf(t);-1!=s;)s=(i=i.replace(t,l)).indexOf(t);return i}(d=-1<d.indexOf(this.gridlocalization.currencysymbol)?d.replace(this.gridlocalization.currencysymbol,""):d,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(d=d.replace(this.gridlocalization.percentsymbol,""));for(var b,g="",w=0;w<d.length;w++)"-"===(b=d.substring(w,w+1))&&(g+="-"),"."===b&&(g+="."),null!=b.match(/^[0-9]+$/)&&(g+=b);d=(d=g).replace(/ /g,""),d=new Number(d),isNaN(d)&&(d="")}this._raiseEvent(17,{rowindex:f,datafield:x.datafield,value:d});var _,y=this.getrowdata(f);a.push({oldvalue:y[x.datafield],value:d,datafield:x.datafield,row:f}),this.pushToHistory=!0,this.setcellvalue(f,p.displayfield,d,!1),this.pushToHistory=!1,p.displayfield!=p.datafield&&this.logicalclipboardselection&&null!=(_=this.logicalclipboardselection[m][p.datafield])&&this.setcellvalue(f,p.datafield,_,!1),this._raiseEvent(18,{rowindex:f,datafield:x.datafield,oldvalue:this.getcellvalue(x.rowindex,x.datafield),value:d}),this._applycellselection(f,x.datafield,!0,!1)}}}}"checkbox"==this.selectionmode&&this._updatecheckboxselection(),this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}this._undoRedo.push({action:"paste",data:a}),this._undoRedoIndex=-1,this.clipboardend&&this.clipboardend("paste")},_applyrowselection:function(e,t,l,i,s){if(null==e)return!1;var o,a,r=this.selectedrowindex,i=("singlerow"==this.selectionmode&&(o=this,setTimeout(function(){t?o._raiseEvent(2,{rowindex:e,row:o.getrowdata(e)}):o._raiseEvent(3,{rowindex:e,row:o.getrowdata(e)}),o._raiseEvent(3,{rowindex:r})}),this.selectedrowindexes=new Array,this.selectedcells=new Array),1==i&&(this.selectedrowindexes=new Array),0<this.dataview.filters.length&&((i=this.getrowdata(e))&&void 0!==i.dataindex?e=i.dataindex:i&&void 0===i.dataindex&&null!=i.uid&&(e=this.getrowboundindexbyid(i.uid))),this.selectedrowindexes.indexOf(e));return t?(this.selectedrowindex=e,-1==i?(this.selectedrowindexes.push(e),"singlerow"!=this.selectionmode&&this._raiseEvent(2,{rowindex:e,row:this.getrowdata(e)})):"multiplerows"==this.selectionmode&&(this.selectedrowindexes.splice(i,1),this._raiseEvent(3,{rowindex:this.selectedrowindex,row:this.getrowdata(e)}),this.selectedrowindex=0<this.selectedrowindexes.length?this.selectedrowindexes[this.selectedrowindexes.length-1]:-1)):(0<=i||"singlerow"==this.selectionmode||"multiplerowsextended"==this.selectionmode||"multiplerowsadvanced"==this.selectionmode)&&(a=this.selectedrowindexes[i],this.selectedrowindexes.splice(i,1),this._raiseEvent(3,{rowindex:a,row:this.getrowdata(e)}),this.selectedrowindex=-1),null!=l&&!l||this._rendervisualrows(),!0},_applycellselection:function(e,t,l,i,s){if(null==e)return!1;if(null==t)return!1;this._autofill&&(this._autofill.remove(),K(document).off("pointermove.autofill"),K(document).off("pointerup.autofill"),this._autofill=null);this.selectedrowindex;"singlecell"==this.selectionmode&&(null!=(o=this.selectedcell)&&this._raiseEvent(16,{rowindex:o.rowindex,datafield:o.datafield}),this.selectedcells=new Array),"multiplecellsextended"!=this.selectionmode&&"multiplecellsadvanced"!=this.selectionmode||null!=(o=this.selectedcell)&&this._raiseEvent(16,{rowindex:o.rowindex,datafield:o.datafield});var o=e+"_"+t,a=(0<this.dataview.filters.length&&((a=this.getrowdata(e))&&void 0!==a.dataindex?o=(e=a.dataindex)+"_"+t:a&&void 0===a.dataindex&&a.uid&&(o=(e=this.getrowboundindexbyid(a.uid))+"_"+t)),{rowindex:e,datafield:t});return l?(e=this.selectedcell,this.selectedcell=a,this.selectedcells[o]?"multiplecells"!=this.selectionmode&&"multiplecellsextended"!=this.selectionmode&&"multiplecellsadvanced"!=this.selectionmode||(delete this.selectedcells[o],0<this.selectedcells.length&&this.selectedcells.length--,!1!==s&&this._raiseEvent(16,a)):(this.selectedcells[o]=a,this.selectedcells.length++,t=!0,(t=e&&e.datafield===a.datafield&&a.rowindex===e.rowindex?!1:t)&&!1!==s&&this._raiseEvent(15,a))):(delete this.selectedcells[o],0<this.selectedcells.length&&this.selectedcells.length--,!1!==s&&this._raiseEvent(16,a)),null!=i&&!i||this._rendervisualrows(),!0},_getcellindex:function(e){var t=-1;return K.each(this.selectedcells,function(){if(t++,this[e])return!1}),t},_clearhoverstyle:function(){if(null!=this.hoveredrow&&-1!=this.hoveredrow&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var e=this.table.find(".jqx-grid-cell-hover");0<e.length&&(e.removeClass(this.toTP("jqx-grid-cell-hover")),e.removeClass(this.toTP("jqx-fill-state-hover")));for(var t=0;t<e.length;t++){var l=e[t].getAttribute("columnindex");!l||(l=this.columns.records[parseInt(l)])&&l._applyCellStyle(e[t])}this.hoveredrow=-1}},_clearselectstyle:function(){for(var e=this.table[0].rows.length,t=this.table[0].rows,l=this.toTP("jqx-grid-cell-selected"),i=this.toTP("jqx-fill-state-pressed"),s=this.toTP("jqx-grid-cell-hover"),o=this.toTP("jqx-fill-state-hover"),a=0;a<e;a++)for(var r=t[a],n=r.cells.length,d=r.cells,c=0;c<n;c++){var h=d[c],u=K(h),u=(-1!=h.className.indexOf("jqx-grid-cell-selected")&&(u.removeClass(l),u.removeClass(i)),-1!=h.className.indexOf("jqx-grid-cell-hover")&&(u.removeClass(s),u.removeClass(o)),h.getAttribute("columnindex"));!u||(u=this.columns.records[parseInt(u)])&&u._applyCellStyle(h)}},_selectpath:function(e,t){var l=this._lastClickedCell?Math.min(this._lastClickedCell.row,e):0,i=this._lastClickedCell?Math.max(this._lastClickedCell.row,e):0;if(l<=i){for(var s=this._getcolumnindex(this._lastClickedCell.column||this._lastClickedCell.datafield),t=this._getcolumnindex(t),o=Math.min(s,t),a=Math.max(s,t),r=(this.selectedcells=new Array,this.dataview.loadedrecords),n=l;n<=i;n++)for(var d=o;d<=a;d++){e=r[n];this._applycellselection(this.getboundindex(e),this._getcolumnat(d).datafield,!0,!1),this.getboundindex(e),this._getcolumnat(d).datafield}this._rendervisualrows()}},_selectrowpath:function(e){if("multiplerowsextended"==this.selectionmode){var t=this._lastClickedCell?Math.min(this._lastClickedCell.row,e):0,l=this._lastClickedCell?Math.max(this._lastClickedCell.row,e):0,i=this.dataview.loadedrecords;if(t<=l){this.selectedrowindexes=new Array;for(var s=t;s<=l;s++){var e=i[s],o=this.getrowboundindex(s);this._applyrowselection(o,!0,!1)}this._rendervisualrows()}}},_selectrowwithmouse:function(e,t,l,i,s,o){var a=t.row;if(null!=a){t=t.index;if(null!=this.hittestinfo[t]){for(var r=0;r<this.columns.records.length;r++){var n=this.columns.records[r];n.selected=!1,n.element&&n.element.removeAttribute("selected"),n._applyStyle()}var d=this.hittestinfo[t].visualrow;if(!this.hittestinfo[t].details){d.cells[0].className;if(!a.group){if("multiplerows"==this.selectionmode||"multiplecells"==this.selectionmode||"checkbox"==this.selectionmode||-1!=this.selectionmode.indexOf("multiple")&&(1==o||1==s)){var c=this.getboundindex(a),h=(0<this.dataview.filters.length&&((h=this.getrowdata(c))&&null==(c=h.dataindex)&&(c=this.getboundindex(a))),-1!=l.indexOf(c)),l=this.getboundindex(a)+"_"+i;if(-1!=this.selectionmode.indexOf("cell")){var c=null!=this.selectedcells[l];null!=this.selectedcells[l]&&c?this._selectcellwithstyle(e,!1,t,i,d):this._selectcellwithstyle(e,!0,t,i,d),!o||null!=this._lastClickedCell||(l=this.getselectedcells())&&0<l.length&&(this._lastClickedCell={row:l[0].rowindex,column:l[0].datafield}),o&&this._lastClickedCell&&(this._selectpath(a.visibleindex,i),this.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")&&this.selectionarea.css("visibility","hidden"))}else if(h?s?this._applyrowselection(this.getboundindex(a),!1):this._selectrowwithstyle(e,d,!1,i):this._selectrowwithstyle(e,d,!0,i),!o||null!=this._lastClickedCell||(c=this.getselectedrowindexes())&&0<c.length&&(this._lastClickedCell={row:c[0],column:i}),o&&this._lastClickedCell){this.selectedrowindexes=new Array;for(var l=this._lastClickedCell?Math.min(this._lastClickedCell.row,a.visibleindex):0,u=this._lastClickedCell?Math.max(this._lastClickedCell.row,a.visibleindex):0,f=this.dataview.loadedrecords,p=l;p<=u;p++)(a=f[p])&&this._applyrowselection(this.getboundindex(a),!0,!1,!1);this._rendervisualrows()}}else this._clearselectstyle(),this._selectrowwithstyle(e,d,!0,i),-1!=this.selectionmode.indexOf("cell")&&this._selectcellwithstyle(e,!0,t,i,d);o||(this._lastClickedCell={row:a.visibleindex,column:i})}}}}},_selectcellwithstyle:function(e,t,l,i,s){s=K(s.cells[e._getcolumnindex(i)]);s.removeClass(this.toTP("jqx-grid-cell-hover")),s.removeClass(this.toTP("jqx-fill-state-hover")),t?(s.addClass(this.toTP("jqx-grid-cell-selected")),s.addClass(this.toTP("jqx-fill-state-pressed"))):(s.removeClass(this.toTP("jqx-grid-cell-selected")),s.removeClass(this.toTP("jqx-fill-state-pressed"))),this.getcolumn(i)._applyCellStyle(s)},_selectrowwithstyle:function(e,t,l,i){var s=t.cells.length,o=0;e.rowdetails&&e.showrowdetailscolumn?this.rtl?(--s,s-=this.groups.length):o=1+this.groups.length:this.groupable&&(this.rtl?s-=this.groups.length:o=this.groups.length);for(var a=o;a<s;a++){var r,n=t.cells[a];l?(K(n).removeClass(this.toTP("jqx-grid-cell-hover")),K(n).removeClass(this.toTP("jqx-fill-state-hover")),-1==e.selectionmode.indexOf("cell")&&(K(n).addClass(this.toTP("jqx-grid-cell-selected")),K(n).addClass(this.toTP("jqx-fill-state-pressed")))):(K(n).removeClass(this.toTP("jqx-grid-cell-hover")),K(n).removeClass(this.toTP("jqx-grid-cell-selected")),K(n).removeClass(this.toTP("jqx-fill-state-hover")),K(n).removeClass(this.toTP("jqx-fill-state-pressed"))),!(i=n.getAttribute("columnindex"))||(r=this.columns.records[parseInt(i)])&&r._applyCellStyle(n)}},_handlemousemoveselection:function(e,l,t){if(l.hScrollInstance.isScrolling()||l.vScrollInstance.isScrolling())return!1;if(("multiplerowsextended"==l.selectionmode||"multiplecellsextended"==l.selectionmode||"multiplecellsadvanced"==l.selectionmode)&&l.mousecaptured){if(l.multipleselectionbegins)if(!1===l.multipleselectionbegins(e))return!0;var i=this.showheader?this.columnsheader.height()+2:0,s=this._groupsheader()?this.groupsheader.height():0,o=(s=s+(this.showtoolbar?this.toolbar.height():0)+(this.showfilterbar?this.toolbarheight:0),this.host.coord()),a=(this.hasTransform&&(o=K.jqx.utilities.getOffset(this.host),r=this._getBodyOffset(),o.left-=r.left,o.top-=r.top),"0px"===this.host.css("border-top-width")&&(s-=2),e.pageX),r=e.pageY-s;if(e._pageX&&(a=e._pageX,r=e._pageY-s),3<Math.abs(this.mousecaptureposition.left-a)||3<Math.abs(this.mousecaptureposition.top-r)||l.autofill){parseInt(this.columnsheader.coord().top);this.hasTransform&&K.jqx.utilities.getOffset(this.columnsheader).top,(a=a<o.left?o.left:a)>o.left+this.host.width()&&(a=o.left+this.host.width());var i=o.top+i,i=(r<i&&(r=i+5),parseInt(Math.min(l.mousecaptureposition.left,a))),n=-5+parseInt(Math.min(l.mousecaptureposition.top,r)),d=parseFloat(Math.abs(l.mousecaptureposition.left-a)),c=parseInt(Math.abs(l.mousecaptureposition.top-r));if(i-=o.left,n-=o.top,this.selectionarea.css("visibility","visible"),"multiplecellsadvanced"==l.selectionmode){for(var h=(a=i)+d,r=l.hScrollInstance,u=r.value,r=(this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(u=r.max-r.value),this.vScrollBar[0].style.visibility),l.table[0].rows[0]),f=0,p=k=l.mousecaptureposition.clickedcell,g=!1,w=0,m=r.cells.length,v=!1,x=w=l.mousecaptureposition.left<=e.pageX?k:w;x<m;x++){var b=parseFloat(K(this.columnsrow[0].cells[x]).css("left")),_=b-u;if(l.columns.records[x].pinned&&!l.columns.records[x].hidden){x==k&&(v=!0);var y=b+K(this.columnsrow[0].cells[x]).width();if(l.mousecaptureposition.left>e.pageX){if(a<=y&&_<=a){p=x,g=!0;break}}else if(h<=y&&_<=h){p=x,g=!0;break}}else{if(v){g=!0,p--;break}b=this._getcolumnat(x);if(!(null!=b&&b.hidden||l.groupable&&0<l.groups.length&&x<l.groups.length)){y=_+K(this.columnsrow[0].cells[x]).width();if(l.mousecaptureposition.left>e.pageX){if(a<=y&&_<=a){p=x,g=!0;break}}else if(h<=y&&_<=h){p=x,g=!0;break}}}}g||(l.mousecaptureposition.left>e.pageX?K.each(this.columns.records,function(e,t){return!!(l.groupable&&0<l.groups.length&&e<l.groups.length)||(this.pinned||this.hidden?void 0:(p=e,!1))}):(!l.groupable||l.groupable&&0<!l.groups.length)&&(p=r.cells.length-1));var w=k,k=Math.min(k,p),p=Math.max(w,p);n=n+5+s;l.table[0].rows.indexOf(l.mousecaptureposition.clickedrow);for(var C=0,q=-1,j=-1,O=0,x=0;x<l.table[0].rows.length;x++){var T=K(l.table[0].rows[x]),S=(0==x&&(O=T.coord().top),T.height()),I=O-o.top;if(-1==q&&n<=I+S){for(var A=!1,P=0;P<l.groups.length;P++)if(-1!=(E=T[0].cells[P].className).indexOf("jqx-grid-group-collapse")||-1!=E.indexOf("jqx-grid-group-expand")){A=!0;break}if(A)continue;q=x}if(O+=S,l.groupable&&0<l.groups.length){for(var E,A=!1,P=0;P<l.groups.length;P++)if(-1!=(E=T[0].cells[P].className).indexOf("jqx-grid-group-collapse")||-1!=E.indexOf("jqx-grid-group-expand")){A=!0;break}if(A)continue;for(var f=0,z=l.groups.length;z<T[0].cells.length;z++){var R=T[0].cells[z];""==K(R).html()&&f++}if(f==T[0].cells.length-l.groups.length)continue}if(-1!=q&&(C+=S),n+c<I+S){j=x;break}}if(-1!=q){n=K(l.table[0].rows[q]).coord().top-o.top-s-2,r=0,w=(this.filterable&&this.showfilterrow&&(r=this.filterrowheight),parseFloat(l.table[0].style.top)<0&&n<this.rowsheight+r&&(n-=parseFloat(l.table[0].style.top),C+=parseFloat(l.table[0].style.top)),c=C,K(this.columnsrow[0].cells[k])),s=K(this.columnsrow[0].cells[p]),i=parseFloat(w.css("left")),d=parseFloat(s.css("left"))-parseFloat(i)+s.width()-2;if(i-=u,v&&(i+=u),l.editcell&&l.editable&&l.endcelledit&&(k!=p||q!=j)){if(0==l.editcell.validated)return;l.endcelledit(l.editcell.row,l.editcell.column,!0,!0)}}}this.selectionarea.width(d),this.selectionarea.css("left",i),null!==t&&(this.selectionarea.css("top",n),this.selectionarea.height(c))}}},_handlemouseupselection:function(t,l,e){if(this.selectionarea){if("visible"!=this.selectionarea[0].style.visibility)return l._handlemousemoveselection(t,l),!1!==e&&(l.__firstcell?(i=l.getselectedcell())&&(l.__firstcell.index=l.columns.records.indexOf(l.getcolumn(i.datafield)),l.__firstcell.row=i.row,l.__firstcell.rowindex=i.rowindex,l._handleAutofill(t,l)):(l.__firstcell=l.getselectedcell(),l.__firstcell&&(l.__firstcell.index=l.columns.records.indexOf(l.getcolumn(l.__firstcell.datafield)),l._handleAutofill(t,l)))),l.mousecaptured=!1,l.selectionarea[0].style.visibility="hidden",!0;if(l.mousecaptured&&("multiplerowsextended"==l.selectionmode||"multiplerowsadvanced"==l.selectionmode||"multiplecellsextended"==l.selectionmode||"multiplecellsadvanced"==l.selectionmode)){if(l.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")){this.selectionarea.css("visibility","hidden");var i=this.showheader?this.columnsheader.height()+2:0,s=this._groupsheader()?this.groupsheader.height():0,o=("0px"===this.host.css("border-top-width")&&(s-=2),this.showtoolbar?this.toolbar.height():0),o=(s=s+o+(this.showfilterbar?this.toolbarheight:0),this.selectionarea.coord()),a=this.host.coord(),r=(this.hasTransform&&(a=K.jqx.utilities.getOffset(this.host),o=K.jqx.utilities.getOffset(this.selectionarea)),"0px"===this.host.css("border-top-width")&&(s-=2),o.left-a.left),n=o.top-i-a.top-s,d=n,c=r+this.selectionarea.width(),h=r,u=new Array,f=new Array;if("multiplerowsextended"==l.selectionmode){for(;n<d+this.selectionarea.height();){var p=(g=this._hittestrow(r,n)).row;-1==(C=g.index)||f[C]||(f[C]=!0,u[u.length]=g),n+=20}d=0;K.each(u,function(){var e=this.row;"none"!=l.selectionmode&&l._selectrowwithmouse&&(!t.ctrlKey&&!t.metaKey&&0==d?l._applyrowselection(l.getboundindex(e),!0,!1,!0):l._applyrowselection(l.getboundindex(e),!0,!1,!1),d++)})}else{var g,w=null,m=null,o=("multiplecellsadvanced"==l.selectionmode&&(n+=2),l.hScrollInstance),v=o.value,x=(this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(v=o.max-o.value),"hidden"!=this.vScrollBar[0].style.visibility&&(v-=this.scrollbarsize+4)),l.table[0].rows[0]),i=l.selectionarea.height(),b=(!t.ctrlKey&&!t.metaKey&&0<i&&(l.selectedcells=new Array),i),_=(parseInt(this.vScrollInstance.value),parseInt(this.hScrollInstance.value)),a=(this._gettableheight(),null!=this._hostwidth?this._hostwidth:this.host.width()),s=this.groupable&&0<this.groups.length?this.groups.length:0,o=this.columns.records.length-s,i=this.groupable&&0<this.groups.length,a=this._getvisualcolumnsindexes(_,a,s,o,i,!0,!0),y=a.start,k=a.end;for(this.__firstcell=null;n<d+b;)if(g=l._hittestrow(r,n)){var p=g.row,C=g.index;if(-1!=C&&!f[C])if(f[C]=!0,this.enableoptimization)for(q=y;q<k;q++){j=(_=parseFloat(l.columnsrow[0].cells[q].style.left)-v)+l.columns.records[q].width;(_<=h&&h<=j||_<=c&&c<=j||h<=_&&_<=c)&&(l._applycellselection(l.getboundindex(p),l._getcolumnat(q).datafield,!0,!1),w={x:r,y:n,rowindex:C,row:l.getboundindex(p),index:q,datafield:l._getcolumnat(q).datafield},l.__lastcell=w,m||(m=w,l.__firstcell=m))}else for(var q=0;q<x.cells.length;q++){var j=(_=parseFloat(K(l.columnsrow[0].cells[q]).css("left"))-v)+K(l.columnsrow[0].cells[q]).width();(_<=h&&h<=j||_<=c&&c<=j||h<=_&&_<=c)&&(l._applycellselection(l.getboundindex(p),l._getcolumnat(q).datafield,!0,!1),w={x:r,y:n,rowindex:C,row:l.getboundindex(p),index:q,datafield:l._getcolumnat(q).datafield},l.__lastcell=w,m||(m=w,l.__firstcell=m))}n+=5}else n+=5}l.autosavestate&&l.savestate&&l.savestate()}l._renderrows(l.virtualsizeinfo),!1!==e&&l._handleAutofill(t,l)}}},_handleAutofill:function(e,a){var t,l,r,i,n,d,c;this.autofill&&((c=this).showheader&&this.columnsheader.height(),i=this._groupsheader()?this.groupsheader.height():0,"0px"===this.host.css("border-top-width")&&(i-=2),new Array,new Array,i=i+(this.showtoolbar?this.toolbar.height():0)+(this.showfilterbar?this.toolbarheight:0),t=this.selectionarea.coord(),l=this.host.coord(),this.hasTransform&&(l=K.jqx.utilities.getOffset(this.host),t=K.jqx.utilities.getOffset(this.selectionarea)),"0px"===this.host.css("border-top-width")&&(i-=2),i=t.left-l.left,t.top,l.top,l=i+this.selectionarea.width(),c.__lastcell,r=c.__firstcell,a.selectionmode,(i=a.hScrollInstance).value,this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(i.max,i.value),"hidden"!=this.vScrollBar[0].style.visibility&&this.scrollbarsize),a.table[0].rows[0],i=a.selectionarea.height(),n=parseInt(e.pageX),d=parseInt(e.pageY),e=i,(c=a)._autofill&&c._autofill.remove(),r&&!c.getcolumn(r.datafield).autofill||c.autofill&&(c._autofill=document.createElement("div"),c._autofill.style.width="6px",c._autofill.style.height="6px",c._autofill.style.position="absolute",c._autofill.style.top=t.top-c.host.offset().top+e+1+"px",c._autofill.style.left=l+2+"px",c._autofill.style.cursor="crosshair",c._autofill.style.paddingLeft="0px",c._autofill.style.paddingTop="0px",c._autofill.style.paddingRight="0px",c._autofill.style.paddingBottom="0px",c._autofill.style.borderTopLeftRadius="0px",c._autofill.style.borderTopRightRadius="0px",c._autofill.style.borderBottomLeftRadius="0px",c._autofill.style.borderBottomRightRadius="0px",c._autofill.style.background="transparent",K(c._autofill).addClass(c.toThemeProperty("jqx-widget")),K(c._autofill).addClass(c.toThemeProperty("jqx-button")),K(c._autofill).addClass(c.toThemeProperty("primary")),K(c._autofill).addClass(c.toThemeProperty("jqx-fill-state-pressed")),c._autofill.onpointerdown=function(e){c._handlemouseupselection(e,c,!1);var e=e.originalEvent||e,t=(c._autofillDragStart=!0,c.mousecaptured=!0,c.showheader?c.columnsheader.height()+2:0),l=c._groupsheader()?c.groupsheader.height():0,i=(l=l+(c.showtoolbar?c.toolbarheight:0)+(c.showfilterbar?c.toolbarheight:0),c.host.coord()),s=n-i.left,o=d-t-i.top-l;if(c.pageable&&!c.autoheight&&c.gotopage&&c.pager.coord().top-i.top-l-t<o)return;i=c._hittestrow(s,o);i&&!i.details&&(i.row,i.index,e.target.className,l=c.table[0].rows[r.rowindex],t=K(a.columnsrow[0].cells[r.index]).coord().left,s=K(l).coord().top+1,c.mousecaptured=!0,c.mousecaptureposition={x:t,y:s,left:e.pageX,top:e.pageY,clickedrow:l},c.copyselection(),e.stopPropagation(),e.preventDefault())},K(document).off("pointermove.autofill"),K(document).off("pointerup.autofill"),K(document).on("pointermove.autofill",function(e){c._autofillDragStart&&(e=e.originalEvent||e,c.mousecaptureposition.position?"y"===c.mousecaptureposition.position?(e._pageX=c.mousecaptureposition.x,e._pageY=e.pageY,c.mousecaptureposition.top=c.mousecaptureposition.y,c._handlemousemoveselection(e,c)):(e._pageX=e.pageX,e._pageY=c.mousecaptureposition.y,c.mousecaptureposition.clickedcell=r.index,c.mousecaptureposition.left=c.mousecaptureposition.x,c._handlemousemoveselection(e,c,null)):5<=Math.abs(c.mousecaptureposition.left-e.pageX)?c.mousecaptureposition.position="x":Math.abs(c.mousecaptureposition.top-e.pageY)&&(c.mousecaptureposition.position="y"))}),K(document).on("pointerup.autofill",function(e){e=e.originalEvent||e;if(!c._autofillDragStart)return c._autofill&&c._autofill.remove(),void c.clearselection();c._handlemouseupselection(e,c),c._autofillDragStart=!1,c.mousecaptureposition=null,c.mousecaptured=!1,c.pasteselection(),c._handlemouseupselection(e,c)}),c.wrapper[0].appendChild(c._autofill)))},selectprevcell:function(e,t){t=this._getcolumnindex(t),this.columns.records.length,t=this._getprevvisiblecolumn(t);null!=t&&(this.clearselection(),this.selectcell(e,t.datafield))},selectnextcell:function(e,t){t=this._getcolumnindex(t),this.columns.records.length,t=this._getnextvisiblecolumn(t);null!=t&&(this.clearselection(),this.selectcell(e,t.datafield))},_getfirstvisiblecolumn:function(){for(var e=this.columns.records.length,t=0;t<e;t++){var l=this.columns.records[t];if(!l.hidden&&null!=l.datafield)return l}return null},_getlastvisiblecolumn:function(){for(var e=this.columns.records.length-1;0<=e;e--){var t=this.columns.records[e];if(!t.hidden&&null!=t.datafield)return t}return null},_handlekeydown:function(f,p){if(p.groupable&&p.groups.length,p.disabled)return!1;if(32===(w=f.charCode||f.keyCode||0)&&(f.metaKey||f.ctrlKey)&&"multiplecellsadvanced"==p.selectionmode){var e=this.getselectedcell();if(f.shiftKey){if(this.clearselection(),this.selectallrows(),this.columns.records.length<30)for(var t,l=0;l<this.columns.records.length;l++)(t=this.columns.records[l]).selectable&&t.toggleSelection(t,f,!0);return void this._renderrows(this.virtualsizeinfo)}e&&(t=this.getcolumn(e.datafield)).selectable&&(this.clearselection(),t.toggleSelection(t,f,!0),this._renderrows(this.virtualsizeinfo))}if(p.editcell&&"multiplecellsadvanced"!=p.selectionmode)return!0;if(p.editcell&&"multiplecellsadvanced"==p.selectionmode){if(!(33<=w&&w<=40))return!0;if(f.altKey)return!(p._cancelkeydown=!1);if(null!=p._cancelkeydown&&0!=p._cancelkeydown)return!(p._cancelkeydown=!1);if("selectedrow"===p.editmode)return!0;if(p.endcelledit(p.editcell.row,p.editcell.column,!1,!0),p._cancelkeydown=!1,p.editcell&&!p.editcell.validated)return p._rendervisualrows(),p.endcelledit(p.editcell.row,p.editcell.column,!1,!0),!1}if("none"==p.selectionmode)return!0;if(p.showfilterrow&&p.filterable&&this.filterrow&&K(f.target).ischildof(p.filterrow))return!0;if(p.showeverpresentrow){if(p.addnewrowtop&&K(f.target).ischildof(p.addnewrowtop))return!0;if(p.addnewrowbottom&&K(f.target).ischildof(p.addnewrowbottom))return!0}if(f.target.className&&0<=f.target.className.indexOf("jqx-grid-widget"))return!0;if(p.pageable&&K(f.target).ischildof(this.pager))return!0;if(this.showtoolbar&&K(f.target).ischildof(this.toolbar))return!0;if(this.showfilterbar&&K(f.target).ischildof(this.filterbar))return!0;if(this.showstatusbar&&K(f.target).ischildof(this.statusbar))return!0;var g=!1;if(f.altKey)return!0;if((f.ctrlKey||f.metaKey)&&this.clipboard){var i,s=String.fromCharCode(w).toLowerCase();if("z"===s&&this._undoRedo){if(-1===this._undoRedoIndex&&(this._undoRedoIndex=this._undoRedo.length-1),i=this._undoRedo[this._undoRedoIndex])if("setcellvalue"===i.action)this.setcellvalue(i.data.row,i.data.datafield,i.data.oldvalue),this.clearselection(),this.selectcell(i.data.row,i.data.datafield),this.ensurecellvisible(i.data.row,i.data.datafield);else if("paste"===i.action){if(this.clearselection(),i.data)for(l=0;l<i.data.length;l++){var o=i.data[l];this.setcellvalue(o.row,o.datafield,o.oldvalue),this._applycellselection(o.row,o.datafield,!0,!1),0===l&&this.ensurecellvisible(o.row,o.datafield)}this._rendervisualrows()}0<this._undoRedoIndex&&this._undoRedoIndex--}if("y"===s&&this._undoRedo){if(-1===this._undoRedoIndex&&(this._undoRedoIndex=this._undoRedo.length-1),i=this._undoRedo[this._undoRedoIndex])if("setcellvalue"===i.action)this.setcellvalue(i.data.row,i.data.datafield,i.data.value),this.clearselection(),this.selectcell(i.data.row,i.data.datafield),this.ensurecellvisible(i.data.row,i.data.datafield);else if("paste"===i.action){this.clearselection();for(l=0;l<i.data.length;l++){o=i.data[l];this.setcellvalue(o.row,o.datafield,o.value),this._applycellselection(o.row,o.datafield,!0,!1),0===l&&this.ensurecellvisible(o.row,o.datafield)}this._rendervisualrows()}this._undoRedoIndex<this._undoRedo.length-1&&this._undoRedoIndex++}if("d"===s&&(this.copyselection(),this._clipboardselection[0],this._clipboardselection=[this._clipboardselection[0]],this.pasteselection(),f.preventDefault(),f.stopPropagation()),this.clipboardbegin){var a=null;if("c"==s?a=this.clipboardbegin("copy",this.copyselection()):"x"==s?a=this.clipboardbegin("cut",this.copyselection()):"v"==s&&(a=this.clipboardbegin("paste")),!1===a)return!1}if("c"==s||"x"==s){var r,a=this.copyselection();if("c"==s&&this.clipboardend&&this.clipboardend("copy"),"x"==s&&this.clipboardend&&this.clipboardend("cut"),window.clipboardData?window.clipboardData.setData("Text",a):((r=K('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>')).val(a),K("body").append(r),r.select(),setTimeout(function(){document.designMode="off",r.select(),r.remove(),p.focus()},100)),"c"==s&&K.jqx.browser.msie)return!1;if("c"==s)return!0}else if("v"==s){if(document.activeElement&&"INPUT"===document.activeElement.nodeName)return!0;var n=K('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>'),d=(K("body").append(n),n.select(),this);return setTimeout(function(){d._clipboardselection=new Array;for(var e,t=n.val(),l=(0==t.length&&window.clipboardData&&(n.val(window.clipboardData.getData("Text")),t=n.val()),t.split("\n")),i=0;i<l.length;i++)0<l[i].split("\t").length&&(1==(e=l[i].split("\t")).length&&i==l.length-1&&""==e[0]||0<e.length&&d._clipboardselection.push(e));d.pasteselection(),n.remove(),d.focus()},100),!0}if("x"==s)return this.deleteselection(),this.host.focus(),!1}var a=Math.round(p._gettableheight()),c=Math.round(a/p.rowsheight),h=p.getdatainformation();switch(p.selectionmode){case"singlecell":case"multiplecells":case"multiplecellsextended":case"multiplecellsadvanced":if(null===(e=p.getselectedcell())&&p.selectcell(0,p.columns.records[0].displayfield),null!=e){var u,w,m,v=this.getrowvisibleindex(e.rowindex),x=e.datafield,b=p._getcolumnindex(x),_=(p.columns.records.length,function(e,t,h,u){function l(e,t){var l,i,s=p.dataview.loadedrecords[e];if(p.groupable&&0<p.groups.length){for(var o=e,s=("up"==u&&o++,"down"==u&&o--,p.getdisplayrows()[o]),a=1,r=!0;r&&a<300&&(r=!1,"down"==u?s=p.getdisplayrows()[o+a]:"up"==u&&(s=p.getdisplayrows()[o-a]),s);){s&&s.group&&(r=!0),s&&s.totalsrow&&(r=!0);for(var n=s.parentItem;n;)!n||(l=n).group&&p.expandedgroups[l.uniqueid]&&p.expandedgroups[l.uniqueid].expanded||(r=!0),n=n.parentItem;if(!r)break;a++}if(300==a&&(s=null),p.pageable){var d=!1;if(s){for(var c=0;c<p.dataview.rows.length;c++)p.dataview.rows[c].boundindex==s.boundindex&&(d=!0);d||(s=null)}}}else if(p.pageable){d=!1;if(s){for(c=0;c<p.dataview.rows.length;c++)p.dataview.rows[c].boundindex==s.boundindex&&(d=!0);d||(p.pagerpageinput&&9===f.keyCode&&s.boundindex>p.dataview.rows[p.dataview.rows.length-1].boundindex&&(p.pagerpageinput.focus(),f.preventDefault()),p.ensurerowvisible(s))}}return null!=s&&null!=t&&!s.totalsrow&&(!h&&null!=h||p.clearselection(),i=p.getboundindex(s),p.selectcell(i,t),p._oldselectedcell=p.selectedcell,g=!0,p.groupable?p.ensurecellvisible(i,t):p.ensurecellvisible(e,t),!0)}var i;l(e,t)||p.groupable||(p.ensurecellvisible(e,t),l(e,t),p.virtualmode&&p.host.focus()),p.groupable&&0<p.groups.length||(f.shiftKey&&9!=f.keyCode?"multiplecellsextended"!=p.selectionmode&&"multiplecellsadvanced"!=p.selectionmode||p._lastClickedCell&&(p._selectpath(e,t),i=p.dataview.loadedrecords[e],i=p.getboundindex(i),p.selectedcell={rowindex:i,datafield:t}):f.shiftKey||(p._lastClickedCell={row:e,column:t}))}),y=f.shiftKey&&"singlecell"!=p.selectionmode&&"multiplecells"!=p.selectionmode,k=function(){var e;p.pageable?(e=p.dataview.pagenum*p.dataview.pagesize,_(e,x,!y)):_(0,x,!y)},C=function(){var e=h.rowscount-1;p.pageable&&(e=p.dataview.pagenum*p.dataview.pagesize+p.dataview.rows.length-1),_(e,x,!y)},q=9==w&&!f.shiftKey,j=9==w&&f.shiftKey;if(p.rtl&&(S=q,q=j,j=S),(q||j)&&(y=!1),(q||j)&&document.activeElement&&document.activeElement.className&&0<=document.activeElement.className.indexOf("jqx-grid-cell-add-new-row"))return!0;(S=f.ctrlKey||f.metaKey)&&37==w?null!=(m=p._getfirstvisiblecolumn(b))&&_(v,m.datafield):S&&39==w?null!=(u=p._getlastvisiblecolumn(b))&&_(v,u.datafield):39==w||q?null!=(u=p._getnextvisiblecolumn(b))?_(v,u.datafield,!y):q?(u=p._getfirstvisiblecolumn(),w=40,x=u.displayfield):g=!0:37==w||j?null!=(m=p._getprevvisiblecolumn(b))?_(v,m.datafield,!y):j?(q=p._getlastvisiblecolumn(),w=38,x=q.displayfield):g=!0:36==w?k():35==w?C():33==w?0<=v-c?(_(O=v-c,x,!y),p.pageable&&p.virtualmode&&(p.gotoprevpage(),setTimeout(function(){_(O,x,!y)},25))):k():34==w&&(h.rowscount>v+c?(_(O=v+c,x,!y),p.pageable&&p.virtualmode&&(p.gotonextpage(),setTimeout(function(){_(O,x,!y)},25))):C()),38==w&&(S?k():0<v?_(v-1,x,!y,"up"):g=!1),40==w&&(S?C():h.rowscount>v+1||p.groupable&&0<p.groups.length?_(v+1,x,!y,"down"):g=!0)}break;case"singlerow":case"multiplerows":case"multiplerowsextended":case"multiplerowsadvanced":if(null==(v=p.getselectedrowindex())||-1==v)return!0;v=this.getrowvisibleindex(v);var O,T=function(e,c,h){function t(e){var t,l,i,s=p.dataview.loadedrecords[e];if(p.groupable&&0<p.groups.length){"up"==h&&e++,"down"==h&&e--;for(var s=p.getdisplayrows()[e],o=1,a=!0;a&&o<300&&(a=!1,"down"==h?s=p.getdisplayrows()[e+o]:"up"==h&&(s=p.getdisplayrows()[e-o]),s);){s&&s.group&&(a=!0),s&&s.totalsrow&&(a=!0);for(var r=s.parentItem;r;)!r||(t=r).group&&p.expandedgroups[t.uniqueid]&&p.expandedgroups[t.uniqueid].expanded||(a=!0),r=r.parentItem;if(!a)break;o++}if(300==o&&(s=null),p.pageable){var n=!1;if(s){for(var d=0;d<p.dataview.rows.length;d++)p.dataview.rows[d].boundindex==s.boundindex&&(n=!0);n||(s=null)}}}return null!=s&&(l=p.getboundindex(s),i=p.selectedrowindex,!c&&null!=c||p.clearselection(),p.selectedrowindex=i,p.selectrow(l,!1),(p.groupable&&0<p.groups.length?p.ensurerowvisible(l):p.ensurerowvisible(e))&&!p.autoheight&&!p.groupable||p._rendervisualrows(),g=!0)}t(e)||p.groupable||(p.ensurerowvisible(e),t(e),p.virtualmode&&setTimeout(function(){t(e)},25),p.virtualmode&&p.host.focus()),p.groupable&&0<p.groups.length||(f.shiftKey&&9!=w?"multiplerowsextended"==p.selectionmode&&p._lastClickedCell&&(p._selectrowpath(e),p.selectedrowindex=p.getrowboundindex(e)):f.shiftKey||(p._lastClickedCell={row:e},p.selectedrowindex=p.getrowboundindex(e)))},y=f.shiftKey&&"singlerow"!=p.selectionmode&&"multiplerows"!=p.selectionmode,k=function(){var e;p.pageable?(e=p.dataview.pagenum*p.dataview.pagesize,T(e,!y)):T(0,!y)},C=function(){var e=h.rowscount-1;p.pageable&&(e=p.dataview.pagenum*p.dataview.pagesize+p.dataview.rows.length-1),T(e,!y)},S=f.ctrlKey||f.metaKey;36==w||S&&38==w?k():35==w||S&&40==w?C():33==w?0<=v-c?(T(O=v-c,!y,"up"),p.pageable&&p.virtualmode&&(p.gotoprevpage(),setTimeout(function(){T(O,!y)},25))):k():34==w?h.rowscount>v+c?(T(O=v+c,!y,"down"),p.pageable&&p.virtualmode&&(p.gotonextpage(),setTimeout(function(){T(O,!y)},25))):C():38==w?0<v?T(v-1,!y,"up"):g=!0:40==w&&(h.rowscount>v+1||p.groupable&&0<p.groups.length?T(v+1,!y,"down"):g=!0)}return!g||(p.autosavestate&&p.savestate&&p.savestate(),!1)},_handlemousemove:function(e,t){var l;if(!t.vScrollInstance.isScrolling()&&(!t.hScrollInstance.isScrolling()&&(!t.enablehover&&"multiplerows"!=t.selectionmode||(i=this.showheader?this.columnsheader.height()+2:0,o=(o=this._groupsheader()?this.groupsheader.height():0)+(this.showtoolbar?this.toolbarheight:0)+(this.showfilterbar?this.toolbarheight:0),s=this.host.coord(),this.hasTransform&&(s=K.jqx.utilities.getOffset(this.host),r=this._getBodyOffset(),s.left-=r.left,s.top-=r.top),l=e.pageX-s.left,r=e.pageY-i-s.top-o),"multiplerowsextended"!=t.selectionmode&&"multiplecellsextended"!=t.selectionmode&&"multiplecellsadvanced"!=t.selectionmode||1!=t.mousecaptured))){if(!t.enablehover)return!0;if(!t.disabled&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var i=this._hittestrow(l,r);if(i){var s=i.row,o=i.index;if((-1==this.hoveredrow||-1==o||this.hoveredrow!=o||-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode)&&(this._clearhoverstyle(),-1!=o&&null!=s)){var a=this.hittestinfo[o].visualrow;if(null!=a&&!(this.hittestinfo[o].details||e.clientX>K(a).width()+K(a).coord().left)){var r=0,n=a.cells.length;if(t.rowdetails&&t.showrowdetailscolumn?this.rtl?(--n,n-=this.groups.length):r=1+this.groups.length:this.groupable&&(this.rtl?n-=this.groups.length:r=this.groups.length),0!=a.cells.length){i=a.cells[r].className;if(!(s.group||0<=this.selectionmode.indexOf("row")&&-1!=i.indexOf("jqx-grid-cell-selected")))if(this.hoveredrow=o,-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode){var d=-1,t=this.hScrollInstance,c=t.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(c=t.max-t.value);for(var h=r;h<n;h++){var u=parseInt(this.columnsrow[0].cells[h].style.left)-c;if(l<=(u=this.columns.records[h].pinned&&!this.rtl?parseInt(this.columnsrow[0].cells[h].style.left):u)+this.columns.records[h].width&&u<=l){d=h;break}}if(-1!=d){var f=a.cells[d];if(this.cellhover&&this.cellhover(f,e.pageX,e.pageY),-1==f.className.indexOf("jqx-grid-cell-selected")&&this.editcell){var p=this._getcolumnat(d);if(p&&this.editcell.row==o&&this.editcell.column==p.datafield)return}K(f).addClass(this.toTP("jqx-grid-cell-hover")),K(f).addClass(this.toTP("jqx-fill-state-hover")),(p=this._getcolumnat(d))._applyCellStyle(f)}}else for(h=r;h<n;h++){f=a.cells[h];K(f).addClass(this.toTP("jqx-grid-cell-hover")),K(f).addClass(this.toTP("jqx-fill-state-hover")),this.cellhover&&this.cellhover(f,e.pageX,e.pageY),(p=this._getcolumnat(h))._applyCellStyle(f)}}}}}}}}})}(jqxBaseFramework);